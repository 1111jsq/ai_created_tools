## MODIFIED Requirements

### Requirement: Markdown 深度分析报告（中文）
系统 SHALL 生成结构化 Markdown，包含：概览（数据量/活跃度）、论文（含发布时间、作者/机构、详细核心内容）、新闻（含发布时间、涉及产品、完整摘要）、SDK 更新、综合洞察（趋势/主题/交叉影响/机会/风险）与附录（文件索引/路径）。

#### Scenario: 成功导出增强报告
- **WHEN** 编排执行完成
- **THEN** 写入 `reports/<range>/weekly-intel-report.md`
- **AND** 论文表格包含：功能、发布时间（如有）、论文标题、作者/机构（如有）、核心内容（详细描述，250字符内）
- **AND** 资讯表格包含：发布时间、资讯标题、涉及产品（如有）、摘要/核心内容（完整摘要，500字符内）
- **AND** 综合洞察包含分层趋势分析、主题聚类、影响分析、机会识别和风险评估

---

### Requirement: LLM 可选与安全降级
当存在 `LLM_API_KEY` 时，系统 SHALL 使用 LLM 生成：
- 论文的详细核心内容（关键贡献、创新点、应用场景）
- 资讯的产品识别和重要度判断
- "综合洞察"部分的深度分析（短期/中期/长期趋势、主题聚类、影响分析、机会识别、风险评估）

当不存在密钥时，SHALL 降级为基于规则的提取和模板化摘要，不中止流程。

#### Scenario: 有密钥启用 LLM 深度分析
- **WHEN** 环境中提供 `LLM_API_KEY`
- **THEN** 论文核心内容包含关键贡献、创新点、应用场景（250字符内）
- **AND** 资讯产品信息被准确提取
- **AND** 生成 LLM 驱动的深度分析段落（趋势、主题、影响、机会、风险），并在日志中标注"LLM 分析已启用"

#### Scenario: 无密钥模板化
- **WHEN** 未提供 `LLM_API_KEY`
- **THEN** 使用规则从标题和标签生成论文核心内容
- **AND** 使用关键词库提取资讯产品信息
- **AND** 使用模板生成基础总结
- **AND** 报告正文中不出现 API Key 或内部错误信息

---

## ADDED Requirements

### Requirement: 论文详细信息提取与展示
系统 SHALL 从论文数据中提取并展示：发布时间、作者/机构信息，并使用 LLM 或规则生成详细的核心内容描述（关键贡献、创新点、应用场景），长度限制为250字符。

#### Scenario: 显示论文详细信息
- **WHEN** 论文数据包含 published_at 字段
- **THEN** 在论文表格中显示发布时间列（格式化为 YYYY-MM-DD）
- **WHEN** 论文数据包含 authors 字段
- **THEN** 在论文表格中显示作者/机构列（显示前3个作者或主要机构）
- **WHEN** 使用 LLM 模式提取核心内容
- **THEN** 核心内容描述包含关键贡献、创新点、应用场景等信息，长度在250字符内

---

### Requirement: 资讯完整摘要与产品分析
系统 SHALL 从 markdown 日报文件中提取完整摘要信息，并提取每条资讯涉及的产品信息，在资讯表格中展示发布时间、涉及产品和完整摘要（最大500字符）。

#### Scenario: 显示资讯完整摘要
- **WHEN** markdown 日报文件包含资讯摘要
- **THEN** 提取完整摘要文本（而非仅从 tags 提取）
- **AND** 在资讯表格中完整展示摘要（最大500字符，不截断到180字符）
- **WHEN** markdown 文件不包含摘要
- **THEN** 使用标签或生成简短描述作为降级方案

#### Scenario: 显示资讯产品信息
- **WHEN** 资讯标题或内容中包含已知产品关键词
- **THEN** 提取涉及的产品名称（最多2个主要产品）
- **AND** 在资讯表格中显示"涉及产品"列
- **WHEN** 使用 LLM 模式且资讯重要性高
- **THEN** 可选使用 LLM 增强产品识别准确性

#### Scenario: 显示资讯发布时间
- **WHEN** 资讯数据包含 published_at 字段
- **THEN** 在资讯表格中显示发布时间列（格式化为 YYYY-MM-DD）
- **WHEN** 资讯数据不包含 published_at 但包含 fetched_at
- **THEN** 使用 fetched_at 作为发布时间显示

---

### Requirement: 深度综合洞察生成
当启用 LLM 模式时，系统 SHALL 生成包含以下层次的深度分析：
- 趋势洞察：短期（本周趋势）、中期（近月模式）、长期（行业方向）
- 主题聚类：识别跨论文、资讯、SDK 的共性主题
- 影响分析：技术影响、市场影响、产业影响
- 机会识别：基于数据和趋势识别的机会点
- 风险评估：潜在风险和挑战

#### Scenario: 生成分层趋势洞察
- **WHEN** LLM 分析启用
- **THEN** 综合洞察部分包含"趋势洞察"小节
- **AND** 趋势洞察分为短期、中期、长期三个层次
- **AND** 每个层次包含具体的趋势描述

#### Scenario: 生成主题聚类分析
- **WHEN** LLM 分析启用
- **THEN** 综合洞察部分包含"主题聚类"小节
- **AND** 识别并分析跨领域（论文、资讯、SDK）的主题模式
- **AND** 每个主题包含具体的数据支撑

#### Scenario: 生成影响与机会分析
- **WHEN** LLM 分析启用
- **THEN** 综合洞察部分包含"影响分析"和"机会识别"小节
- **AND** 影响分析涵盖技术、市场、产业三个维度
- **AND** 机会识别基于数据和趋势提供具体建议

#### Scenario: 生成风险评估
- **WHEN** LLM 分析启用
- **THEN** 综合洞察部分包含"风险评估"小节
- **AND** 识别潜在的技术风险、市场风险、合规风险等

